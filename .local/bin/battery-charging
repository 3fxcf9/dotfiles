#!/bin/sh

# Send a notification when the laptop is plugged in/unplugged
# Add the following to /etc/udev/rules.d/60-power.rules (replace USERNAME with your user)

# ACTION=="change", SUBSYSTEM=="power_supply", ATTR{type}=="Mains", ATTR{online}=="0", ENV{DISPLAY}=":0", ENV{XAUTHORITY}="/home/USERNAME/.Xauthority" RUN+="/usr/bin/su USERNAME -c '/home/USERNAME/.local/bin/battery-charging discharging'"
# ACTION=="change", SUBSYSTEM=="power_supply", ATTR{type}=="Mains", ATTR{online}=="1", ENV{DISPLAY}=":0", ENV{XAUTHORITY}="/home/USERNAME/.Xauthority" RUN+="/usr/bin/su USERNAME -c '/home/USERNAME/.local/bin/battery-charging charging'"

export XAUTHORITY=~/.Xauthority
export DISPLAY=:0
export DBUS_SESSION_BUS_ADDRESS="unix:path=/run/user/$(id -u)/bus"

# Get battery info directly (more reliable)
BATTERY_INFO=$(acpi -b | grep "Battery 0")
BATTERY_LEVEL=$(echo "$BATTERY_INFO" | grep -oP '\d+(?=%+)')
BATTERY_STATE=$(echo "$BATTERY_INFO" | awk '{print $3}' | tr '[:upper:]' '[:lower:]')  # Normalize to lowercase

case "$BATTERY_STATE" in
    "charging,") BATTERY_CHARGING="Discharging" ; BATTERY_ICON="discharging" ;;
    "not") BATTERY_CHARGING="Charging" ; BATTERY_ICON="charging" ;;
    "discharging,") BATTERY_CHARGING="Charging" ; BATTERY_ICON="charging" ;;
    *) BATTERY_CHARGING="Unknown" ; BATTERY_ICON="unknown" ;;  # Fallback
esac

# Send notification
notify-send "${BATTERY_CHARGING}" "${BATTERY_LEVEL}% battery." -u normal -i "battery-${BATTERY_ICON}" -t 5000 -r 9991
